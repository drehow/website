---
title: Student Opinion Survey Analysis
author: ''
date: '2021-05-06'
slug: student-opinion-survey-analysis
categories: []
tags:
  - text_parsing
  - data_science
  - exploratory_data_analysis
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>
<script src="{{< blogdown/postref >}}index_files/core-js/shim.min.js"></script>
<script src="{{< blogdown/postref >}}index_files/react/react.min.js"></script>
<script src="{{< blogdown/postref >}}index_files/react/react-dom.min.js"></script>
<script src="{{< blogdown/postref >}}index_files/reactwidget/react-tools.js"></script>
<script src="{{< blogdown/postref >}}index_files/htmlwidgets/htmlwidgets.js"></script>
<script src="{{< blogdown/postref >}}index_files/reactable-binding/reactable.js"></script>


<pre class="r"><code>library(grid)
library(gridExtra)
library(ggplot2)</code></pre>
<pre><code>## Warning: package &#39;ggplot2&#39; was built under R version 3.6.3</code></pre>
<pre class="r"><code>library(tidyr)</code></pre>
<pre><code>## Warning: package &#39;tidyr&#39; was built under R version 3.6.3</code></pre>
<pre class="r"><code>library(RColorBrewer) 
library(reactable)</code></pre>
<pre><code>## Warning: package &#39;reactable&#39; was built under R version 3.6.3</code></pre>
<pre class="r"><code>files &lt;- list.files(&#39;sos&#39;)
options &lt;- c(&#39;Strongly disagree&#39;, &#39;Disagree&#39;, &#39;Neutral&#39;, &#39;Agree&#39;, &#39;Strongly agree&#39;)

y=1
j=5
for(y in 1:length(files)){
  
  doc &lt;- readLines(paste0(&#39;sos/&#39;,files[y]))
  prompts &lt;- doc[grep(&#39;Strongly agree&#39;, doc) - 1]
  
  results &lt;- data.frame(&#39;prompt&#39; = rep(prompts, length(options))[order(rep(prompts, length(options)))]
                        ,&#39;semester&#39; = gsub(&#39;.txt&#39;,&#39;&#39;,files[y])
                        ,&#39;sentiment&#39; = rep(options, length(prompts))
                        ,&#39;count&#39; =NA)
  
  for(j in 1:length(options)){
    temp_doc &lt;- doc[grepl(options[j], doc)]
    counts &lt;- as.numeric(substr(temp_doc,nchar(options[j]) + 6, nchar(options[j]) + 8))
    results$count[results$sentiment == options[j]] &lt;- counts[order(prompts)]
  }
  
  if(y==1){
    all_results &lt;- results
  } else {
    all_results &lt;- rbind(all_results, results)
  }
  
}</code></pre>
<pre><code>## Warning in readLines(paste0(&quot;sos/&quot;, files[y])): incomplete final line found on
## &#39;sos/202005.txt&#39;</code></pre>
<pre><code>## Warning in readLines(paste0(&quot;sos/&quot;, files[y])): incomplete final line found on
## &#39;sos/202012.txt&#39;</code></pre>
<pre><code>## Warning in readLines(paste0(&quot;sos/&quot;, files[y])): incomplete final line found on
## &#39;sos/202105.txt&#39;</code></pre>
<pre class="r"><code>all_results &lt;- all_results[!grepl(&#39;Christ&#39;,all_results$prompt),]
all_results$sentiment &lt;- ifelse(all_results$sentiment==&#39;Strongly disagree&#39;, &#39;SD&#39;,
                                ifelse(all_results$sentiment==&#39;Disagree&#39;, &#39;D&#39;,
                                       ifelse(all_results$sentiment==&#39;Neutral&#39;, &#39;N&#39;,
                                              ifelse(all_results$sentiment==&#39;Agree&#39;, &#39;A&#39;,
                                                     ifelse(all_results$sentiment==&#39;Strongly agree&#39;, &#39;SA&#39;, NA)))))
all_results$sentiment &lt;- factor(all_results$sentiment, levels = c(&#39;SD&#39;,&#39;D&#39;,&#39;N&#39;,&#39;A&#39;,&#39;SA&#39;))

df_opinion &lt;- spread(all_results, sentiment, count)
        
reactable(df_opinion
          , groupBy = &quot;prompt&quot;
          , defaultColDef = colDef(
              header = function(value) gsub(&quot;.&quot;, &quot; &quot;, value, fixed = TRUE),
              cell = function(value) format(value, nsmall = 1),
              align = &quot;center&quot;,
              minWidth = 70,
              headerStyle = list(background = &quot;#f7f7f8&quot;)
          )
          , columns = list(
                prompt = colDef(align = &quot;left&quot;)
                ,semester = colDef(maxWidth = 80)
                ,SD = colDef(aggregate = &quot;sum&quot;, maxWidth = 50)
                ,D = colDef(aggregate = &quot;sum&quot;, maxWidth = 50)
                ,N = colDef(aggregate = &quot;sum&quot;, maxWidth = 50)
                ,A = colDef(aggregate = &quot;sum&quot;, maxWidth = 50)
                ,SA = colDef(aggregate = &quot;sum&quot;, maxWidth = 50)
            )
          ,bordered = TRUE
          ,highlight = TRUE
)</code></pre>
<div id="htmlwidget-1" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"prompt":["Exams and other means of measuring my performance were relevant to course objectives and course content.","Exams and other means of measuring my performance were relevant to course objectives and course content.","Exams and other means of measuring my performance were relevant to course objectives and course content.","I feel this course will be relevant for accomplishing my future career goals.","I feel this course will be relevant for accomplishing my future career goals.","I feel this course will be relevant for accomplishing my future career goals.","I would like to take another course from this instructor.","I would like to take another course from this instructor.","I would like to take another course from this instructor.","The course requirements were clearly explained.","The course requirements were clearly explained.","The course requirements were clearly explained.","The instructor demonstrated a knowledge of the subject.","The instructor demonstrated a knowledge of the subject.","The instructor demonstrated a knowledge of the subject.","The instructor demonstrated the significance of the subject matter through relevant examples or life experiences.","The instructor demonstrated the significance of the subject matter through relevant examples or life experiences.","The instructor demonstrated the significance of the subject matter through relevant examples or life experiences.","The instructor motivated me to learn.","The instructor motivated me to learn.","The instructor motivated me to learn.","The instructor seemed enthusiastic about teaching.","The instructor seemed enthusiastic about teaching.","The instructor seemed enthusiastic about teaching.","The instructor seemed to care about students.","The instructor seemed to care about students.","The instructor seemed to care about students.","The instructor showed courtesy, respect, and professionalism when relating to students.","The instructor showed courtesy, respect, and professionalism when relating to students.","The instructor showed courtesy, respect, and professionalism when relating to students.","The instructor was reachable through reasonable and timely means (e.g., kept stated office hours, answered email, accepted phone calls, or other means as appropriate to the course).","The instructor was reachable through reasonable and timely means (e.g., kept stated office hours, answered email, accepted phone calls, or other means as appropriate to the course).","The instructor was reachable through reasonable and timely means (e.g., kept stated office hours, answered email, accepted phone calls, or other means as appropriate to the course).","There was agreement between the course objectives in the syllabus and what was actually taught.","There was agreement between the course objectives in the syllabus and what was actually taught.","There was agreement between the course objectives in the syllabus and what was actually taught."],"semester":["202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105"],"SD":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"D":[0,0,0,0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"N":[0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,0,0,0,0,0,1,1,0,1,0,0,1],"A":[2,2,0,3,1,0,2,1,0,3,2,0,3,1,0,3,1,1,2,2,1,2,2,2,1,2,2,2,2,0,1,2,2,2,2,3],"SA":[4,3,6,3,4,6,3,4,6,3,3,5,3,4,7,3,4,6,3,3,5,3,3,5,5,3,5,4,3,6,4,3,4,4,3,3]},"columns":[{"accessor":"prompt","name":"prompt","type":"factor","cell":["Exams and other means of measuring my performance were relevant to course objectives and course content.","Exams and other means of measuring my performance were relevant to course objectives and course content.","Exams and other means of measuring my performance were relevant to course objectives and course content.","I feel this course will be relevant for accomplishing my future career goals.","I feel this course will be relevant for accomplishing my future career goals.","I feel this course will be relevant for accomplishing my future career goals.","I would like to take another course from this instructor.","I would like to take another course from this instructor.","I would like to take another course from this instructor.","The course requirements were clearly explained.","The course requirements were clearly explained.","The course requirements were clearly explained.","The instructor demonstrated a knowledge of the subject.","The instructor demonstrated a knowledge of the subject.","The instructor demonstrated a knowledge of the subject.","The instructor demonstrated the significance of the subject matter through relevant examples or life experiences.","The instructor demonstrated the significance of the subject matter through relevant examples or life experiences.","The instructor demonstrated the significance of the subject matter through relevant examples or life experiences.","The instructor motivated me to learn.","The instructor motivated me to learn.","The instructor motivated me to learn.","The instructor seemed enthusiastic about teaching.","The instructor seemed enthusiastic about teaching.","The instructor seemed enthusiastic about teaching.","The instructor seemed to care about students.","The instructor seemed to care about students.","The instructor seemed to care about students.","The instructor showed courtesy, respect, and professionalism when relating to students.","The instructor showed courtesy, respect, and professionalism when relating to students.","The instructor showed courtesy, respect, and professionalism when relating to students.","The instructor was reachable through reasonable and timely means (e.g., kept stated office hours, answered email, accepted phone calls, or other means as appropriate to the course).","The instructor was reachable through reasonable and timely means (e.g., kept stated office hours, answered email, accepted phone calls, or other means as appropriate to the course).","The instructor was reachable through reasonable and timely means (e.g., kept stated office hours, answered email, accepted phone calls, or other means as appropriate to the course).","There was agreement between the course objectives in the syllabus and what was actually taught.","There was agreement between the course objectives in the syllabus and what was actually taught.","There was agreement between the course objectives in the syllabus and what was actually taught."],"header":"prompt","minWidth":70,"align":"left","headerStyle":{"background":"#f7f7f8"}},{"accessor":"semester","name":"semester","type":"factor","cell":["202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105","202005","202012","202105"],"header":"semester","minWidth":70,"align":"center","headerStyle":{"background":"#f7f7f8"},"maxWidth":80},{"accessor":"SD","name":"SD","type":"numeric","cell":["0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0"],"header":"SD","minWidth":70,"align":"center","headerStyle":{"background":"#f7f7f8"},"aggregate":"sum","maxWidth":50},{"accessor":"D","name":"D","type":"numeric","cell":["0.0","0.0","0.0","0.0","0.0","1.0","0.0","0.0","1.0","0.0","0.0","1.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0"],"header":"D","minWidth":70,"align":"center","headerStyle":{"background":"#f7f7f8"},"aggregate":"sum","maxWidth":50},{"accessor":"N","name":"N","type":"numeric","cell":["0.0","0.0","1.0","0.0","0.0","0.0","1.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","0.0","1.0","1.0","0.0","0.0","0.0","0.0","0.0","0.0","0.0","1.0","1.0","0.0","1.0","0.0","0.0","1.0"],"header":"N","minWidth":70,"align":"center","headerStyle":{"background":"#f7f7f8"},"aggregate":"sum","maxWidth":50},{"accessor":"A","name":"A","type":"numeric","cell":["2.0","2.0","0.0","3.0","1.0","0.0","2.0","1.0","0.0","3.0","2.0","0.0","3.0","1.0","0.0","3.0","1.0","1.0","2.0","2.0","1.0","2.0","2.0","2.0","1.0","2.0","2.0","2.0","2.0","0.0","1.0","2.0","2.0","2.0","2.0","3.0"],"header":"A","minWidth":70,"align":"center","headerStyle":{"background":"#f7f7f8"},"aggregate":"sum","maxWidth":50},{"accessor":"SA","name":"SA","type":"numeric","cell":["4.0","3.0","6.0","3.0","4.0","6.0","3.0","4.0","6.0","3.0","3.0","5.0","3.0","4.0","7.0","3.0","4.0","6.0","3.0","3.0","5.0","3.0","3.0","5.0","5.0","3.0","5.0","4.0","3.0","6.0","4.0","3.0","4.0","4.0","3.0","3.0"],"header":"SA","minWidth":70,"align":"center","headerStyle":{"background":"#f7f7f8"},"aggregate":"sum","maxWidth":50}],"pivotBy":["prompt"],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"highlight":true,"bordered":true,"dataKey":"cdee685afa4c8ddfd581f2f86a1321b8","key":"cdee685afa4c8ddfd581f2f86a1321b8"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
<pre class="r"><code># # Plots for last semester
# last_semester &lt;- all_results[all_results$semester == 202105,]
# 
# #define custom color scale
# myColors &lt;- brewer.pal(5, &quot;RdYlGn&quot;)
# names(myColors) &lt;- levels(all_results$sentiment)
# custom_colors &lt;- scale_colour_manual(name = &quot;sentiment&quot;, values = myColors)
# 
# u_prompts &lt;- as.character(unique(all_results$prompt))
# 
# plot_prompt &lt;- function(i){
#   
#   temp &lt;- last_semester[last_semester$prompt==u_prompts[i],]
#   p &lt;- ggplot(data = temp, aes(x = sentiment, y = count)) +
#     geom_bar(fill = myColors, stat=&#39;identity&#39;, color = &#39;black&#39;) +
#     labs(x = NULL, y = NULL, title = NULL) + 
#     theme_bw()
#   
#   key &lt;- u_prompts[i]
#   key_wraped &lt;- strwrap(key, width = 40, simplify = FALSE) # modify 30 to your needs
#   key_new &lt;- sapply(key_wraped, paste, collapse = &quot;\n&quot;)
#   margin &lt;- ifelse(length(key_wraped[[1]]) == 1, 5,
#                    ifelse(length(key_wraped[[1]]) == 2, 4,
#                           ifelse(length(key_wraped[[1]]) == 3, 3,
#                                  ifelse(length(key_wraped[[1]]) == 4, 2,
#                                         ifelse(length(key_wraped[[1]]) == 5, 1,
#                                                ifelse(length(key_wraped[[1]]) == 6, 0, 0))))))
#   
#   title.grob &lt;- textGrob(
#     label = key_new,
#     x = unit(0, &quot;lines&quot;), 
#     y = unit(margin, &quot;lines&quot;),
#     hjust = 0, vjust = 0,
#     gp = gpar(fontsize = 14))
#   
#   p &lt;- grid.arrange(arrangeGrob(title.grob, p, ncol=2))
#   grid.draw(p)
# }
# 
# for(i in 1:length(u_prompts)){
#   plot_prompt(i)
# }</code></pre>
