---
title: Student Opinion Survey Analysis
author: ''
date: '2021-05-06'
slug: student-opinion-survey-analysis
categories: []
tags:
  - text_parsing
  - data_science
  - exploratory_data_analysis
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<pre class="r"><code># setwd(&#39;C:/Users/drew.howell/Desktop/personal_apps/public_site/working_cont/sos&#39;)
#---------------------

library(grid)
library(gridExtra)
library(ggplot2)</code></pre>
<pre><code>## Warning: package &#39;ggplot2&#39; was built under R version 3.6.3</code></pre>
<pre class="r"><code>library(tidyr)</code></pre>
<pre><code>## Warning: package &#39;tidyr&#39; was built under R version 3.6.3</code></pre>
<pre class="r"><code>library(RColorBrewer) 

files &lt;- list.files(&#39;sos&#39;)
options &lt;- c(&#39;Strongly disagree&#39;, &#39;Disagree&#39;, &#39;Neutral&#39;, &#39;Agree&#39;, &#39;Strongly agree&#39;)

y=1
j=5
for(y in 1:length(files)){
  doc &lt;- readLines(paste0(&#39;sos/&#39;,files[y]))
  prompts &lt;- doc[grep(&#39;Strongly agree&#39;, doc) - 1]
  results &lt;- data.frame(&#39;prompt&#39; = rep(prompts, length(options))[order(rep(prompts, length(options)))]
                        ,&#39;semester&#39; = gsub(&#39;.txt&#39;,&#39;&#39;,files[y])
                        ,&#39;sentiment&#39; = rep(options, length(prompts))
                        ,&#39;count&#39; =NA)
                        # ,&#39;SD&#39;=NA
                        # ,&#39;D&#39;=NA
                        # ,&#39;N&#39;=NA
                        # ,&#39;A&#39;=NA
                        # ,&#39;SA&#39;=NA)
  for(j in 1:length(options)){
    temp_doc &lt;- doc[grepl(options[j], doc)]
    counts &lt;- as.numeric(substr(temp_doc,nchar(options[j]) + 6, nchar(options[j]) + 8))
    results$count[results$sentiment == options[j]] &lt;- counts[order(prompts)]
  }
  if(y==1){
    all_results &lt;- results
  } else {
    all_results &lt;- rbind(all_results, results)
  }
}</code></pre>
<pre><code>## Warning in readLines(paste0(&quot;sos/&quot;, files[y])): incomplete final line found on
## &#39;sos/202005.txt&#39;</code></pre>
<pre><code>## Warning in readLines(paste0(&quot;sos/&quot;, files[y])): incomplete final line found on
## &#39;sos/202012.txt&#39;</code></pre>
<pre><code>## Warning in readLines(paste0(&quot;sos/&quot;, files[y])): incomplete final line found on
## &#39;sos/202105.txt&#39;</code></pre>
<pre class="r"><code># setwd(&#39;../..&#39;)
all_results &lt;- all_results[!grepl(&#39;Christ&#39;,all_results$prompt),]
all_results$sentiment &lt;- ifelse(all_results$sentiment==&#39;Strongly disagree&#39;, &#39;SD&#39;,
                                ifelse(all_results$sentiment==&#39;Disagree&#39;, &#39;D&#39;,
                                       ifelse(all_results$sentiment==&#39;Neutral&#39;, &#39;N&#39;,
                                              ifelse(all_results$sentiment==&#39;Agree&#39;, &#39;A&#39;,
                                                     ifelse(all_results$sentiment==&#39;Strongly agree&#39;, &#39;SA&#39;, NA)))))
all_results$sentiment &lt;- factor(all_results$sentiment, levels = c(&#39;SD&#39;,&#39;D&#39;,&#39;N&#39;,&#39;A&#39;,&#39;SA&#39;))
# Plots for last semester
last_semester &lt;- all_results[all_results$semester == 202105,]

# spread(last_semester, prompt, SD)

#define custom color scale
myColors &lt;- brewer.pal(5, &quot;RdYlGn&quot;)
names(myColors) &lt;- levels(all_results$sentiment)
custom_colors &lt;- scale_colour_manual(name = &quot;sentiment&quot;, values = myColors)

u_prompts &lt;- as.character(unique(all_results$prompt))

# i=5
# for(i in 1:length(u_prompts)){
#   temp &lt;- last_semester[last_semester$prompt==u_prompts[i],]
#   p &lt;- ggplot(data = temp, aes(x = sentiment, y = count)) +
#     geom_bar(fill = myColors, stat=&#39;identity&#39;, color = &#39;black&#39;) +
#     labs(x = NULL, y = NULL, title = NULL) + 
#     theme_bw()
#   
#   key &lt;- u_prompts[i]
#   key_wraped &lt;- strwrap(key, width = 30, simplify = FALSE) # modify 30 to your needs
#   key_new &lt;- sapply(key_wraped, paste, collapse = &quot;\n&quot;)
#   
#   title.grob &lt;- textGrob(
#     label = key_new,
#     x = unit(0, &quot;lines&quot;), 
#     y = unit(0, &quot;lines&quot;),
#     hjust = 0, vjust = -0.5,
#     gp = gpar(fontsize = 16))
#   
#   p &lt;- arrangeGrob(p, left = title.grob)
#   grid.refresh()
#   grid.draw(p)
# }

plot_prompt &lt;- function(i){
  # grid.refresh()
  # if(i!=1){
  #   grid.newpage()
  # }
  temp &lt;- last_semester[last_semester$prompt==u_prompts[i],]
  p &lt;- ggplot(data = temp, aes(x = sentiment, y = count)) +
    geom_bar(fill = myColors, stat=&#39;identity&#39;, color = &#39;black&#39;) +
    labs(x = NULL, y = NULL, title = NULL) + 
    theme_bw()
  
  key &lt;- u_prompts[i]
  key_wraped &lt;- strwrap(key, width = 45, simplify = FALSE) # modify 30 to your needs
  key_new &lt;- sapply(key_wraped, paste, collapse = &quot;\n&quot;)
  margin &lt;- ifelse(length(key_wraped[[1]]) == 1, 5,
                   ifelse(length(key_wraped[[1]]) == 2, 4,
                          ifelse(length(key_wraped[[1]]) == 3, 3,
                                 ifelse(length(key_wraped[[1]]) == 4, 2,
                                        ifelse(length(key_wraped[[1]]) == 5, 1,
                                               ifelse(length(key_wraped[[1]]) == 6, 0, 0))))))
  title.grob &lt;- textGrob(
    label = key_new,
    x = unit(0, &quot;lines&quot;), 
    y = unit(margin, &quot;lines&quot;),
    hjust = 0, vjust = 0,
    gp = gpar(fontsize = 16))
  
  p &lt;- grid.arrange(arrangeGrob(title.grob, p, ncol=2))
  
  
  # ggplot() + 
    grid.draw(p)
  # reset.par()
}



# 
# 
# ggplot(last_semester) + 
#   geom_bar(aes(x=sentiment, y=count), fill = myColors, stat=&#39;identity&#39;) + 
#   # ggtitle(u_prompts[i]) + 
#   theme_bw() + 
#   facet_grid(prompt ~ count)

#---------------------
for(i in 1:length(u_prompts)){
  plot_prompt(i)
}</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-1.png" width="768" /><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-2.png" width="768" /><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-3.png" width="768" /><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-4.png" width="768" /><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-5.png" width="768" /><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-6.png" width="768" /><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-7.png" width="768" /><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-8.png" width="768" /><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-9.png" width="768" /><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-10.png" width="768" /><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-11.png" width="768" /><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-12.png" width="768" /></p>
<pre class="r"><code># print(plot_prompt(10))
# print(plot_prompt(3))</code></pre>
